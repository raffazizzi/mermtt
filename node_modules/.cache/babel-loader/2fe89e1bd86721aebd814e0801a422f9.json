{"ast":null,"code":"var _jsxFileName = \"/home/rviglian/Projects/mermtt/src/Music.js\";\nimport React from 'react';\nimport Verovio from './Verovio';\nimport TeiElement from './TeiElement';\nimport './Music.scss';\n\nclass Music extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {};\n  }\n\n  componentDidMount() {\n    this.renderMusic(this.props.notatedMusic.querySelector('tei-ptr').getAttribute('target'));\n  }\n\n  forwardTeiAttributes() {\n    return Array.from(this.props.notatedMusic.attributes).reduce((acc, att) => {\n      acc[att.name] = att.value;\n      return acc;\n    }, {});\n  }\n\n  async renderMusic(url) {\n    const meiData = await fetch(`/data/${url}`).then(response => response.text()); // This is an example\n\n    const type = this.props.notatedMusic.getAttribute('type');\n    let pageWidth = 800;\n\n    if (type === 'tipo1') {\n      pageWidth = 400;\n    } else if (type === 'tipo2') {\n      pageWidth = 100;\n    }\n\n    Verovio.loadData(meiData);\n    Verovio.setOptions({\n      pageWidth,\n      adjustPageHeight: true,\n      scale: 50\n    });\n    this.setState({\n      meiData,\n      svg: Verovio.renderPage(1)\n    });\n  }\n\n  render() {\n    const url = this.props.notatedMusic.querySelector('tei-ptr').getAttribute('target');\n    const label = React.createElement(TeiElement, {\n      teiDomElement: this.props.notatedMusic.querySelector('tei-label'),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 46\n      },\n      __self: this\n    });\n    let music = ''; // If there is a tei-graphic element, then show the image, otherwise render with Verovio.\n\n    const image = this.props.notatedMusic.querySelector('tei-graphic');\n\n    if (image) {\n      music = React.createElement(TeiElement, {\n        teiDomElement: this.props.notatedMusic.querySelector('tei-graphic'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 51\n        },\n        __self: this\n      });\n    } else if (this.state.svg) {\n      music = React.createElement(\"div\", {\n        dangerouslySetInnerHTML: {\n          __html: this.state.svg\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 53\n        },\n        __self: this\n      });\n    }\n\n    const header = React.createElement(\"div\", {\n      className: \"MusicHeader\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 55\n      },\n      __self: this\n    }, label, \" \\xA0 \", React.createElement(\"a\", {\n      href: `/data/${url}`,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 56\n      },\n      __self: this\n    }, \"MEI\"));\n    const children = React.createElement(React.Fragment, null, header, music);\n    return React.createElement(this.props.notatedMusic.tagName.toLowerCase(), { ...this.forwardTeiAttributes()\n    }, children);\n  }\n\n}\n\nexport default Music;","map":{"version":3,"sources":["/home/rviglian/Projects/mermtt/src/Music.js"],"names":["React","Verovio","TeiElement","Music","Component","constructor","props","state","componentDidMount","renderMusic","notatedMusic","querySelector","getAttribute","forwardTeiAttributes","Array","from","attributes","reduce","acc","att","name","value","url","meiData","fetch","then","response","text","type","pageWidth","loadData","setOptions","adjustPageHeight","scale","setState","svg","renderPage","render","label","music","image","__html","header","children","createElement","tagName","toLowerCase"],"mappings":"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","sourcesContent":["import React from 'react'\nimport Verovio from './Verovio'\nimport TeiElement from './TeiElement'\nimport './Music.scss'\n\nclass Music extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = { }\n  }\n\n  componentDidMount() {\n    this.renderMusic(this.props.notatedMusic.querySelector('tei-ptr').getAttribute('target'))\n  }\n\n  forwardTeiAttributes() {\n    return Array.from(this.props.notatedMusic.attributes).reduce((acc, att) => {\n      acc[att.name] = att.value\n      return acc\n    }, {})\n  }\n\n  async renderMusic(url) {\n    const meiData = await fetch(`/data/${url}`).then(response => response.text())\n\n    // This is an example\n    const type = this.props.notatedMusic.getAttribute('type')\n    let pageWidth = 800\n    if (type === 'tipo1') {\n      pageWidth = 400\n    } else if (type === 'tipo2') {\n      pageWidth = 100\n    }\n\n    Verovio.loadData(meiData)\n    Verovio.setOptions({\n      pageWidth,\n      adjustPageHeight: true,\n      scale: 50\n    })\n    this.setState({meiData, svg: Verovio.renderPage(1)}) \n  }\n\n  render() {\n    const url = this.props.notatedMusic.querySelector('tei-ptr').getAttribute('target')\n    const label = <TeiElement teiDomElement={this.props.notatedMusic.querySelector('tei-label')} />\n    let music = ''\n    // If there is a tei-graphic element, then show the image, otherwise render with Verovio.\n    const image = this.props.notatedMusic.querySelector('tei-graphic')\n    if (image) {\n      music = <TeiElement teiDomElement={this.props.notatedMusic.querySelector('tei-graphic')} />\n    } else if (this.state.svg) {\n      music = <div dangerouslySetInnerHTML={{__html: this.state.svg}}/>\n    }\n    const header = (<div className=\"MusicHeader\">\n      {label} &nbsp; <a href={`/data/${url}`}>MEI</a>\n    </div>)\n    const children = (<>{header}{music}</>)\n    return React.createElement(this.props.notatedMusic.tagName.toLowerCase(), \n      {\n        ...this.forwardTeiAttributes(),\n      }, \n      children\n    )\n  }\n}\n\nexport default Music\n"]},"metadata":{},"sourceType":"module"}