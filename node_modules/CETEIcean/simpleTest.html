<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="css/CETEIcean.css" media="screen" charset="utf-8">
    <style media="screen">
      tei-g[ref="char:cmbAbbrStroke"] {
        margin-left: -.45em;
      }
      tei-hi {
        font-style: italic;
      }
      tei-pb + tei-pb {
        display: none;
      }
      tei-seg[rend="decorInit"] {
        font-family: cursive;
        font-size: 300%;
      }
      tei-trailer {
        display: block;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div id="TEI"></div>
    <script src="../dist/CETEI.js"></script>
    <script>
      var CETEIcean = new CETEI();
      var pageimage = "images/page.jpg";
      var pagereq = new XMLHttpRequest();
      pagereq.addEventListener("load", function() {
        if (!pagereq.responseText.includes("403 Forbidden")) {
          pageimage = "http://eebo.chadwyck.com/fetchimage";
        }
      });
      pagereq.open("GET", "http://eebo.chadwyck.com/fetchimage", false);
      CETEIcean.addBehaviors({"handlers":
        {
          "gap": ["[", "]"],
          // this function doesn't use createdCallback or other Web Objects
          // functionality, and so will be used by all browsers.
          "note": function() {
            var elts = this.dom.getElementsByTagName("tei-note");
            for (var i = 0; i < elts.length; i++) {
              var elt = elts[i];
              var span = document.createElement("span");
              span.innerHTML = elt.getAttribute("place") == "margin"?"[<em>in marg.</em> ":"[";
              elt.insertBefore(span, elt.firstChild);
              span = document.createElement("span"),
              span.innerHTML = "]";
              elt.appendChild(span);
            }
          },
          "pb": function(proto) {
            var self = this;
            proto.createdCallback = function() {
              var shadow = this.createShadowRoot();
              var link = document.createElement("a");
              link.setAttribute("style", "float:right; padding-left: 1em;");
              if (this.hasAttribute("facs")) {
                var facs = this.getAttribute("facs").replace("tcp:", "").replace(new RegExp(self.prefixes["tcp"]["matchPattern"]), pageimage + "?vid=$1&page=$2");
                link.setAttribute("href", facs + "&width=1500");
                var img = document.createElement("img");
                img.setAttribute("src", facs + "&width=100");
                img.setAttribute("height", "50px");
                if (this.hasAttribute("n")) {
                  link.innerHTML = "p. " + this.getAttribute("n") + " ";
                }
                link.appendChild(img);
              }
              shadow.appendChild(document.createElement("br"));
              shadow.appendChild(link);
              shadow.appendChild(document.createElement("br"));
              shadow.appendChild(document.createElement("br"));
              shadow.appendChild(document.createElement("br"));
            }
          }
        },
      "fallbacks": {
        "pb": function() {
          var elts = this.dom.getElementsByTagName("tei-pb");
          for (var i = 0; i < elts.length; i++) {
            var pgbr = document.createElement("span");
            var link = document.createElement("a");
            link.setAttribute("style", "float:right; padding-left: 1em;");
            if (elts[i].hasAttribute("facs")) {
              var facs = elts[i].getAttribute("facs").replace("tcp:", "").replace(new RegExp(this.prefixes["tcp"]["matchPattern"]), pageimage + "?vid=$1&page=$2");
              link.setAttribute("href", facs + "&width=1500");
              var img = document.createElement("img");
              img.setAttribute("src", facs + "&width=100");
              img.setAttribute("height", "50px");
              if (elts[i].hasAttribute("n")) {
                link.innerHTML = "p. " + elts[i].getAttribute("n") + " ";
              }
              link.appendChild(img);
            }
            pgbr.appendChild(document.createElement("br"));
            pgbr.appendChild(link);
            pgbr.appendChild(document.createElement("br"));
            pgbr.appendChild(document.createElement("br"));
            pgbr.appendChild(document.createElement("br"));
            elts[i].insertAdjacentElement("afterbegin", pgbr);
          }
        }
      }});
      CETEIcean.getHTML5('https://raw.githubusercontent.com/textcreationpartnership/A00689/master/A00689.xml', function(data) {
        document.getElementById("TEI").appendChild(data);
        CETEIcean.addStyle(document, data);
      });

    </script>
  </body>
</html>
