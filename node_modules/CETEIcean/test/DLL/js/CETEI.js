var CETEI=function(){"use strict";var e={};e.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var t={handlers:{ptr:['<a href="$@target">$@target</a>',"</a>"],ref:function(e){var t=this;e.createdCallback=function(){var e=this.createShadowRoot(),r=document.createElement("a");r.innerHTML=this.innerHTML,r.href=t.rewriteRelativeUrl(this.getAttribute("target")),e.appendChild(r)}},graphic:function(e){var t=this;e.createdCallback=function(){var e=this.createShadowRoot(),r=new Image;r.src=t.rewriteRelativeUrl(this.getAttribute("url")),this.hasAttribute("width")&&(r.width=this.getAttribute("width").replace(/[^.0-9]/g,"")),this.hasAttribute("height")&&(r.height=this.getAttribute("height").replace(/[^.0-9]/g,"")),e.appendChild(r)}}},fallbacks:{ref:function(){for(var e=this,t=this.dom.getElementsByTagName("tei-ref"),r=0;r<t.length;r++)t[r].addEventListener("click",function(t){window.location=e.rewriteRelativeUrl(this.getAttribute("target"))})},graphic:function(){for(var e=this,t=this.dom.getElementsByTagName("tei-graphic"),r=0;r<t.length;r++){var a=new Image,n=t[r];a.src=e.rewriteRelativeUrl(this.getAttribute("url")),n.hasAttribute("width")&&(a.width=n.getAttribute("width").replace(/[^.0-9]/g,"")),n.hasAttribute("height")&&(a.height=n.getAttribute("height").replace(/[^.0-9]/g,"")),n.appendChild(a)}}}},r=function(){function r(a){e.classCallCheck(this,r),this.els=[],this.behaviors=[],this.hasStyle=!1,this.prefixes=[],a?this.base=a:this.base=window.location.href.replace(/\/[^\/]*$/,"/"),this.behaviors.push(t)}return e.createClass(r,[{key:"getHTML5",value:function(e,t){var r=this,a=new Promise(function(t,r){var a=new XMLHttpRequest;a.open("GET",e),a.send(),a.onload=function(){this.status>=200&&this.status<300?t(this.response):r(this.statusText)},a.onerror=function(){r(this.statusText)}}).then(function(e){r.makeHTML5(e,t)})["catch"](function(e){console.log(e)});return a}},{key:"makeHTML5",value:function(e,t){var r=this,a=(new window.DOMParser).parseFromString(e,"text/xml");this._fromTEI(a);var n=function i(e){var t=void 0,a=!1;switch(e.namespaceURI){case"http://www.tei-c.org/ns/1.0":t=document.createElement("tei-"+e.tagName);break;case"http://www.tei-c.org/ns/Examples":t=document.createElement("teieg-"+e.tagName);break;default:t=document.importNode(e,!1),a=!0}var n=!0,l=!1,o=void 0;try{for(var s,h=Array.from(e.attributes)[Symbol.iterator]();!(n=(s=h.next()).done);n=!0){var c=s.value;"xmlns"!=c.name||a?t.setAttribute(c.name,c.value):t.setAttribute("data-xmlns",c.value),"xml:id"!=c.name||a||t.setAttribute("id",c.value),"xml:lang"!=c.name||a||t.setAttribute("lang",c.value),"rendition"==c.name&&t.setAttribute("class",c.value.replace(/#/g,""))}}catch(u){l=!0,o=u}finally{try{!n&&h["return"]&&h["return"]()}finally{if(l)throw o}}var d=!0,f=!1,v=void 0;try{for(var m,g=Array.from(e.childNodes)[Symbol.iterator]();!(d=(m=g.next()).done);d=!0){var y=m.value;y.nodeType==Node.ELEMENT_NODE?t.appendChild(i(y)):t.appendChild(y.cloneNode())}}catch(u){f=!0,v=u}finally{try{!d&&g["return"]&&g["return"]()}finally{if(f)throw v}}if("tagsDecl"==e.localName){var b=document.createElement("style"),p=!0,w=!1,A=void 0;try{for(var k,E=Array.from(e.childNodes)[Symbol.iterator]();!(p=(k=E.next()).done);p=!0){var T=k.value;if(T.nodeType==Node.ELEMENT_NODE&&"rendition"==T.localName&&"css"==T.getAttribute("scheme")){var C="";T.hasAttribute("selector")?(C+=T.getAttribute("selector").replace(/([^#, >]+\w*)/g,"tei-$1").replace(/#tei-/g,"#")+"{\n",C+=T.textContent):(C+="."+T.getAttribute("xml:id")+"{\n",C+=T.textContent),C+="\n}\n",b.appendChild(document.createTextNode(C))}}}catch(u){w=!0,A=u}finally{try{!p&&E["return"]&&E["return"]()}finally{if(w)throw A}}b.childNodes.length>0&&(t.appendChild(b),r.hasStyle=!0)}return"prefixDef"==e.localName&&(r.prefixes.push(e.getAttribute("ident")),r.prefixes[e.getAttribute("ident")]={matchPattern:e.getAttribute("matchPattern"),replacementPattern:e.getAttribute("replacementPattern")}),t};return this.dom=n(a.documentElement),document.registerElement?this.registerAll(this.els):this.fallback(this.els),t?void t(this.dom):this.dom}},{key:"addStyle",value:function(e,t){this.hasStyle&&e.getElementsByTagName("head").item(0).appendChild(t.getElementsByTagName("style").item(0).cloneNode(!0))}},{key:"addBehaviors",value:function(e){e.handlers||e.fallbacks?this.behaviors.push(e):console.log("No handlers or fallback methods found.")}},{key:"_insert",value:function(e,t){if(e.createShadowRoot){var r=e.createShadowRoot();t.length>1?r.innerHTML=t[0]+r.innerHTML+t[1]:r.innerHTML=t[0]+r.innerHTML}else{var a=document.createElement("span");a.innerHTML=t[0],e.insertAdjacentElement?e.insertAdjacentElement("afterbegin",a):e.firstChild?e.insertBefore(a,e.firstChild):e.appendChild(a),t.length>1&&(a=document.createElement("span"),a.innerHTML=t[1],e.appendChild(a))}}},{key:"decorator",value:function(e,t){return function(){for(var r=this.dom.getElementsByTagName("tei-"+e),a=0;a<r.length;a++){for(var n=r[a],i=0;i<t.length;i++)if(t[i].includes("$@")){var l=t[i].match(/(\$@\w+)/),o=!0,s=!1,h=void 0;try{for(var c,u=l[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var d=c.value;n.hasAttribute(d.substring(2))&&(t[i]=t[i].replace(/\$@\w+/,n.getAttribute(d.substring(2))))}}catch(f){s=!0,h=f}finally{try{!o&&u["return"]&&u["return"]()}finally{if(s)throw h}}}this._insert(n,t)}}}},{key:"createdCallback",value:function(e,t){e.createdCallback=t.call(this)}},{key:"shadow",value:function(e,t){return function(){var e=this.createShadowRoot(),r=t.call(this);e.appendChild(r)}}},{key:"getHandler",value:function(e){var t=!0,r=!1,a=void 0;try{for(var n,i=this.behaviors.reverse()[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var l=n.value;if(l.handlers[e])return Array.isArray(l.handlers[e])?this.decorator(e,l.handlers[e]):l.handlers[e]}}catch(o){r=!0,a=o}finally{try{!t&&i["return"]&&i["return"]()}finally{if(r)throw a}}}},{key:"getFallback",value:function(e){var t=!0,r=!1,a=void 0;try{for(var n,i=this.behaviors.reverse()[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var l=n.value;if(l.fallbacks[e])return Array.isArray(l.fallbacks[e])?this.decorator(e,l.fallbacks[e]):l.fallbacks[e];if(l.handlers[e]&&Array.isArray(l.handlers[e]))return this.decorator(e,l.handlers[e]);if(l.handlers[e]&&0==l.handlers[e].length)return l.handlers[e]}}catch(o){r=!0,a=o}finally{try{!t&&i["return"]&&i["return"]()}finally{if(r)throw a}}}},{key:"registerAll",value:function(e){var t=!0,r=!1,a=void 0;try{for(var n,i=e[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var l=n.value,o=Object.create(HTMLElement.prototype),s=this.getHandler(l);s&&s.call(this,o);var h="tei-"+l;try{document.registerElement(h,{prototype:o})}catch(c){console.log(h+" already registered."),console.log(c)}}}catch(u){r=!0,a=u}finally{try{!t&&i["return"]&&i["return"]()}finally{if(r)throw a}}}},{key:"fallback",value:function(e){var t=!0,r=!1,a=void 0;try{for(var n,i=e[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var l=n.value,o=this.getFallback(l);o&&o.call(this)}}catch(s){r=!0,a=s}finally{try{!t&&i["return"]&&i["return"]()}finally{if(r)throw a}}}},{key:"setBaseUrl",value:function(e){this.base=e}},{key:"rewriteRelativeUrl",value:function(e){return e.match(/^(?:http|mailto|file|\/).*$/)?e:this.base+e}},{key:"fromODD",value:function(){}},{key:"_fromTEI",value:function(e){var t=e.documentElement;this.els=new Set(Array.from(t.getElementsByTagName("*"),function(e){return e.tagName})),this.els.add(t.tagName)}}]),r}();return window&&(window.CETEI=r),r}();